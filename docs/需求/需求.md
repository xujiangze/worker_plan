# 工作计划管理系统需求文档

## 1. 项目概述

### 1.1 项目背景
工作计划管理系统是一个帮助用户规划、跟踪和统计工作计划的应用程序。通过该系统,用户可以创建工作计划、跟踪进度、查看统计数据,从而提高工作效率。

### 1.2 项目目标
- 提供便捷的工作计划管理功能
- 支持计划进度的实时跟踪
- 提供多维度的统计分析
- 确保数据安全和系统性能

### 1.3 技术栈
- **后端语言**: Go (Golang)
- **前端语言**: Vue.js
- **数据库**: PostgreSQL
- **ORM**: GORM
- **开发工具**: Claude Code + OpenSpec

## 2. 功能需求

### 2.1 计划管理

#### 2.1.1 创建工作计划
**功能描述**: 用户可以创建新的工作计划,包含以下信息:
- 计划标题(必填)
- 计划描述(选填)
- 优先级(高/中/低)
- 截止日期(选填)
- 初始状态:待开始

**用户场景**:
- 用户登录系统后,点击"创建计划"按钮
- 填写计划标题"完成项目文档"
- 选择优先级为"高"
- 设置截止日期为"2026-01-10"
- 点击"保存"按钮
- 系统创建计划并显示成功提示

#### 2.1.2 编辑工作计划
**功能描述**: 用户可以修改已创建的工作计划的任何信息。

**用户场景**:
- 用户在计划列表中找到要编辑的计划
- 点击"编辑"按钮
- 修改计划描述或截止日期
- 点击"保存"按钮
- 系统更新计划信息

#### 2.1.3 删除工作计划
**功能描述**: 用户可以删除不再需要的工作计划。

**用户场景**:
- 用户在计划列表中找到要删除的计划
- 点击"删除"按钮
- 系统弹出确认对话框
- 用户确认删除
- 系统删除计划并显示成功提示

#### 2.1.4 查询工作计划
**功能描述**: 用户可以查询和筛选工作计划列表。

**用户场景**:
- 用户访问计划列表页面
- 系统显示所有工作计划
- 用户可以按以下条件筛选:
  - 状态:待开始、进行中、已完成、已取消
  - 优先级:高、中、低
  - 日期范围:创建日期、截止日期
- 用户可以按以下字段排序:
  - 创建时间
  - 截止日期
  - 优先级
  - 状态

### 2.2 进度跟踪

#### 2.2.1 更新计划状态
**功能描述**: 用户可以更新工作计划的状态。

**状态定义**:
- **待开始(Todo)**: 计划已创建但尚未开始执行
- **进行中(InProgress)**: 计划正在执行中
- **已完成(Done)**: 计划已完成
- **已取消(Cancelled)**: 计划已取消

**用户场景**:
- 用户在计划详情页面点击"开始"按钮
- 系统将状态从"待开始"更新为"进行中"
- 系统记录状态变更时间

#### 2.2.2 记录计划进度
**功能描述**: 用户可以更新计划的完成百分比。

**用户场景**:
- 用户在计划详情页面拖动进度条
- 或直接输入完成百分比(0-100)
- 系统保存进度信息
- 当进度达到100%时,系统自动将状态更新为"已完成"

#### 2.2.3 查看计划历史
**功能描述**: 用户可以查看计划的所有历史变更记录。

**用户场景**:
- 用户在计划详情页面点击"历史记录"标签
- 系统显示以下信息:
  - 状态变更记录(旧状态→新状态,变更时间)
  - 进度更新记录(旧进度→新进度,更新时间)
  - 计划信息修改记录(修改的字段、旧值、新值、修改时间)

### 2.3 统计分析

#### 2.3.1 按状态统计
**功能描述**: 系统提供按状态统计工作计划的功能。

**统计内容**:
- 各状态计划数量
- 各状态计划占比
- 状态分布图表(饼图或柱状图)

**用户场景**:
- 用户访问统计页面
- 系统显示:
  - 待开始: 5个计划(25%)
  - 进行中: 8个计划(40%)
  - 已完成: 6个计划(30%)
  - 已取消: 1个计划(5%)

#### 2.3.2 按优先级统计
**功能描述**: 系统提供按优先级统计工作计划的功能。

**统计内容**:
- 各优先级计划数量
- 各优先级计划占比
- 优先级分布图表

**用户场景**:
- 用户访问统计页面
- 系统显示:
  - 高优先级: 3个计划(15%)
  - 中优先级: 10个计划(50%)
  - 低优先级: 7个计划(35%)

#### 2.3.3 按时间统计
**功能描述**: 系统提供按时间范围统计工作计划的功能。

**统计内容**:
- 指定时间范围内创建的计划数量
- 指定时间范围内完成的计划数量
- 时间趋势图表(折线图)

**用户场景**:
- 用户选择时间范围:2026-01-01 至 2026-01-31
- 系统显示:
  - 本月创建计划: 15个
  - 本月完成计划: 8个
  - 每日创建/完成计划趋势图

#### 2.3.4 查看完成率
**功能描述**: 系统计算并显示工作计划的完成率。

**计算公式**:
```
完成率 = (已完成计划数 / 总计划数) × 100%
```

**用户场景**:
- 用户访问统计页面
- 系统显示:
  - 总计划数: 20个
  - 已完成: 12个
  - 完成率: 60%

## 3. 数据模型设计

### 3.1 工作计划表(Plans)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | bigint | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| title | varchar(255) | 计划标题 | NOT NULL |
| description | text | 计划描述 | NULL |
| priority | varchar(20) | 优先级 | NOT NULL, ENUM('High', 'Medium', 'Low') |
| status | varchar(20) | 状态 | NOT NULL, ENUM('Todo', 'InProgress', 'Done', 'Cancelled') |
| due_date | timestamp | 截止日期 | NULL |
| progress | int | 完成百分比 | NOT NULL, DEFAULT 0, RANGE(0-100) |
| created_at | timestamp | 创建时间 | NOT NULL, DEFAULT CURRENT_TIMESTAMP |
| updated_at | timestamp | 更新时间 | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP |
| deleted_at | timestamp | 删除时间 | NULL (软删除) |

### 3.2 计划历史表(PlanHistory)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | bigint | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| plan_id | bigint | 计划ID | NOT NULL, FOREIGN KEY REFERENCES Plans(id) |
| field_name | varchar(50) | 变更字段 | NOT NULL |
| old_value | text | 旧值 | NULL |
| new_value | text | 新值 | NULL |
| change_type | varchar(20) | 变更类型 | NOT NULL, ENUM('Status', 'Progress', 'Info') |
| changed_at | timestamp | 变更时间 | NOT NULL, DEFAULT CURRENT_TIMESTAMP |

## 4. API 设计

### 4.1 计划管理 API

#### 4.1.1 创建计划
```
POST /api/plans
Content-Type: application/json

Request Body:
{
  "title": "完成项目文档",
  "description": "编写项目的技术文档和用户手册",
  "priority": "High",
  "due_date": "2026-01-10T23:59:59Z"
}

Response (201 Created):
{
  "id": 1,
  "title": "完成项目文档",
  "description": "编写项目的技术文档和用户手册",
  "priority": "High",
  "status": "Todo",
  "due_date": "2026-01-10T23:59:59Z",
  "progress": 0,
  "created_at": "2026-01-05T12:00:00Z",
  "updated_at": "2026-01-05T12:00:00Z"
}
```

#### 4.1.2 查询计划列表
```
GET /api/plans?status=InProgress&priority=High&sort=due_date&order=asc&page=1&page_size=20

Response (200 OK):
{
  "total": 15,
  "page": 1,
  "page_size": 20,
  "data": [
    {
      "id": 1,
      "title": "完成项目文档",
      "description": "编写项目的技术文档和用户手册",
      "priority": "High",
      "status": "InProgress",
      "due_date": "2026-01-10T23:59:59Z",
      "progress": 50,
      "created_at": "2026-01-05T12:00:00Z",
      "updated_at": "2026-01-05T14:30:00Z"
    }
  ]
}
```

#### 4.1.3 查询单个计划
```
GET /api/plans/:id

Response (200 OK):
{
  "id": 1,
  "title": "完成项目文档",
  "description": "编写项目的技术文档和用户手册",
  "priority": "High",
  "status": "InProgress",
  "due_date": "2026-01-10T23:59:59Z",
  "progress": 50,
  "created_at": "2026-01-05T12:00:00Z",
  "updated_at": "2026-01-05T14:30:00Z"
}
```

#### 4.1.4 更新计划
```
PUT /api/plans/:id
Content-Type: application/json

Request Body:
{
  "title": "完成项目文档(更新)",
  "description": "编写项目的技术文档、用户手册和API文档",
  "priority": "High",
  "due_date": "2026-01-12T23:59:59Z"
}

Response (200 OK):
{
  "id": 1,
  "title": "完成项目文档(更新)",
  "description": "编写项目的技术文档、用户手册和API文档",
  "priority": "High",
  "status": "InProgress",
  "due_date": "2026-01-12T23:59:59Z",
  "progress": 50,
  "created_at": "2026-01-05T12:00:00Z",
  "updated_at": "2026-01-05T15:00:00Z"
}
```

#### 4.1.5 删除计划
```
DELETE /api/plans/:id

Response (204 No Content)
```

### 4.2 进度管理 API

#### 4.2.1 更新计划状态
```
PATCH /api/plans/:id/status
Content-Type: application/json

Request Body:
{
  "status": "InProgress"
}

Response (200 OK):
{
  "id": 1,
  "status": "InProgress",
  "updated_at": "2026-01-05T15:00:00Z"
}
```

#### 4.2.2 更新计划进度
```
PATCH /api/plans/:id/progress
Content-Type: application/json

Request Body:
{
  "progress": 75
}

Response (200 OK):
{
  "id": 1,
  "progress": 75,
  "status": "InProgress",
  "updated_at": "2026-01-05T15:00:00Z"
}
```

### 4.3 统计分析 API

#### 4.3.1 按状态统计
```
GET /api/stats/by-status

Response (200 OK):
{
  "Todo": {
    "count": 5,
    "percentage": 25
  },
  "InProgress": {
    "count": 8,
    "percentage": 40
  },
  "Done": {
    "count": 6,
    "percentage": 30
  },
  "Cancelled": {
    "count": 1,
    "percentage": 5
  }
}
```

#### 4.3.2 按优先级统计
```
GET /api/stats/by-priority

Response (200 OK):
{
  "High": {
    "count": 3,
    "percentage": 15
  },
  "Medium": {
    "count": 10,
    "percentage": 50
  },
  "Low": {
    "count": 7,
    "percentage": 35
  }
}
```

#### 4.3.3 按时间统计
```
GET /api/stats/by-time?start_date=2026-01-01&end_date=2026-01-31

Response (200 OK):
{
  "created_count": 15,
  "completed_count": 8,
  "completion_rate": 53.33,
  "daily_trend": [
    {
      "date": "2026-01-01",
      "created": 2,
      "completed": 0
    },
    {
      "date": "2026-01-02",
      "created": 1,
      "completed": 1
    }
  ]
}
```

#### 4.3.4 查看完成率
```
GET /api/stats/completion-rate

Response (200 OK):
{
  "total_plans": 20,
  "completed_plans": 12,
  "completion_rate": 60
}
```

### 4.4 历史记录 API

#### 4.4.1 查询计划历史
```
GET /api/plans/:id/history

Response (200 OK):
{
  "total": 5,
  "data": [
    {
      "id": 1,
      "field_name": "status",
      "old_value": "Todo",
      "new_value": "InProgress",
      "change_type": "Status",
      "changed_at": "2026-01-05T12:30:00Z"
    },
    {
      "id": 2,
      "field_name": "progress",
      "old_value": "0",
      "new_value": "50",
      "change_type": "Progress",
      "changed_at": "2026-01-05T14:00:00Z"
    }
  ]
}
```

## 5. 非功能性需求

### 5.1 性能要求
- **API 响应时间**: P95 < 200ms
- **并发用户**: 支持至少 1000 个并发用户
- **数据库查询**: 单次查询时间 < 100ms
- **页面加载**: 首屏加载时间 < 2s

### 5.2 安全要求
- **数据加密**: 敏感数据使用 HTTPS 传输
- **身份认证**: 支持用户登录和身份验证(未来扩展)
- **权限控制**: 用户只能访问自己的计划数据(未来扩展)
- **SQL 注入防护**: 使用参数化查询,防止 SQL 注入
- **XSS 防护**: 前端对用户输入进行转义和验证

### 5.3 可用性要求
- **系统可用性**: 99.5% 以上
- **数据备份**: 每日自动备份数据库
- **错误处理**: 友好的错误提示和日志记录
- **监控告警**: 关键指标监控和异常告警

### 5.4 可扩展性要求
- **水平扩展**: 支持通过增加服务器节点扩展系统容量
- **模块化设计**: 功能模块独立,便于扩展新功能
- **API 版本管理**: 支持 API 版本控制,便于向后兼容

### 5.5 可维护性要求
- **代码规范**: 遵循 Go 和 Vue.js 官方代码规范
- **文档完整**: 提供完整的 API 文档和开发文档
- **测试覆盖**: 单元测试覆盖率 > 70%
- **日志记录**: 完善的日志记录,便于问题排查

## 6. 用户界面设计

### 6.1 计划列表页面
- 显示所有工作计划
- 支持按状态、优先级、日期筛选
- 支持按创建时间、截止日期、优先级排序
- 显示计划的关键信息:标题、状态、优先级、截止日期、进度
- 提供创建、编辑、删除操作按钮

### 6.2 计划详情页面
- 显示计划的完整信息
- 显示计划的历史变更记录
- 提供更新状态和进度的操作
- 提供编辑和删除操作

### 6.3 创建/编辑计划表单
- 表单字段:标题(必填)、描述(选填)、优先级(必填)、截止日期(选填)
- 表单验证:必填字段验证、日期格式验证
- 提交按钮:保存、取消

### 6.4 统计仪表盘
- 显示各种统计图表:
  - 状态分布饼图
  - 优先级分布柱状图
  - 时间趋势折线图
- 显示关键指标:
  - 总计划数
  - 已完成数
  - 完成率
- 支持时间范围选择

## 7. 技术架构

### 7.1 后端架构
- **框架**: Go 标准库 + Gin/Echo(可选)
- **ORM**: GORM
- **数据库**: PostgreSQL
- **架构模式**: 分层架构(Controller → Service → Repository)
- **依赖注入**: 使用依赖注入模式管理组件

### 7.2 前端架构
- **框架**: Vue.js 3
- **状态管理**: Pinia
- **路由**: Vue Router
- **UI 组件库**: Element Plus / Ant Design Vue
- **HTTP 客户端**: Axios

### 7.3 数据库设计
- **数据库**: PostgreSQL 14+
- **连接池**: 使用连接池管理数据库连接
- **索引**: 为常用查询字段创建索引
- **事务**: 关键操作使用事务保证数据一致性

## 8. 开发计划

### 8.1 第一阶段:基础功能
- 数据库设计和初始化
- 计划管理 API 开发
- 前端计划列表和详情页面
- 基本的创建、编辑、删除功能

### 8.2 第二阶段:进度跟踪
- 进度管理 API 开发
- 前端进度更新界面
- 历史记录功能

### 8.3 第三阶段:统计分析
- 统计分析 API 开发
- 前端统计仪表盘
- 图表展示

### 8.4 第四阶段:优化和完善
- 性能优化
- 安全加固
- 测试完善
- 文档完善

## 9. 验收标准

### 9.1 功能验收
- 所有功能需求均已实现
- 所有用户场景均可正常使用
- API 接口符合设计规范

### 9.2 性能验收
- API 响应时间 P95 < 200ms
- 支持 1000 个并发用户
- 页面加载时间 < 2s

### 9.3 质量验收
- 单元测试覆盖率 > 70%
- 无严重 Bug
- 代码符合规范

### 9.4 文档验收
- API 文档完整
- 用户手册完整
- 开发文档完整

## 10. 附录

### 10.1 术语表
- **工作计划**: 用户创建的任务或目标
- **状态**: 计划的执行状态(待开始、进行中、已完成、已取消)
- **优先级**: 计划的重要程度(高、中、低)
- **进度**: 计划的完成百分比(0-100)
- **完成率**: 已完成计划占总计划数的百分比

### 10.2 参考资料
- Go 官方文档: https://golang.org/doc/
- Vue.js 官方文档: https://vuejs.org/
- PostgreSQL 官方文档: https://www.postgresql.org/docs/
- GORM 官方文档: https://gorm.io/docs/
- RESTful API 设计指南: https://restfulapi.net/
