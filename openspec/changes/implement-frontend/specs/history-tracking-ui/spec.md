# Spec: History Tracking UI

## ADDED Requirements

### Requirement: 历史记录列表
前端 MUST 提供历史记录列表,显示计划的所有变更历史。

#### Scenario: 显示历史记录列表
**Given** 用户在历史记录页面 `/plans/:id/history`
**When** 页面加载完成
**Then** 系统显示该计划的所有历史记录
**And** 历史记录按时间降序排列(最新的在前)
**And** 每条历史记录显示:
  - 变更时间(格式:YYYY-MM-DD HH:mm:ss)
  - 变更类型标签(状态/进度/信息)
  - 变更字段名称
  - 旧值
  - 新值
  - 变更图标

#### Scenario: 显示状态变更记录
**Given** 用户在历史记录页面
**When** 系统显示状态变更记录
**Then** 记录显示:
  - 变更时间:"2026-01-05 15:00:00"
  - 变更类型标签:"状态变更"(蓝色)
  - 变更字段:"状态"
  - 旧值:"待开始"(灰色)
  - 新值:"进行中"(蓝色)
  - 变更图标:状态图标

#### Scenario: 显示进度变更记录
**Given** 用户在历史记录页面
**When** 系统显示进度变更记录
**Then** 记录显示:
  - 变更时间:"2026-01-05 14:00:00"
  - 变更类型标签:"进度变更"(绿色)
  - 变更字段:"进度"
  - 旧值:"0%"(灰色)
  - 新值:"50%"(绿色)
  - 变更图标:进度图标

#### Scenario: 显示信息变更记录
**Given** 用户在历史记录页面
**When** 系统显示信息变更记录
**Then** 记录显示:
  - 变更时间:"2026-01-05 15:00:00"
  - 变更类型标签:"信息变更"(灰色)
  - 变更字段:"标题"
  - 旧值:"完成项目文档"(灰色)
  - 新值:"完成项目文档(更新)"(黑色)
  - 变更图标:编辑图标

#### Scenario: 显示多个字段变更记录
**Given** 用户在历史记录页面
**When** 系统显示多个字段同时变更的记录
**Then** 系统为每个变更字段创建一条独立的历史记录
**And** 每条记录的变更时间相同
**And** 记录按变更类型分组显示

#### Scenario: 显示空值变更记录
**Given** 用户在历史记录页面
**When** 系统显示字段从空值变为有值的记录
**Then** 记录显示:
  - 旧值:"(空)"(灰色)
  - 新值:"新的描述"(黑色)

#### Scenario: 显示清空字段变更记录
**Given** 用户在历史记录页面
**When** 系统显示字段从有值变为空值的记录
**Then** 记录显示:
  - 旧值:"旧的描述"(灰色)
  - 新值:"(空)"(灰色)

### Requirement: 历史记录筛选
前端 MUST 提供历史记录筛选功能,允许用户按变更类型和时间范围筛选。

#### Scenario: 按变更类型筛选
**Given** 用户在历史记录页面
**When** 用户点击筛选下拉框,选择"状态变更"
**Then** 系统只显示变更类型为"状态变更"的历史记录
**And** 筛选条件显示在页面上
**And** 筛选条件显示为标签,可以点击关闭

#### Scenario: 按多个变更类型筛选
**Given** 用户在历史记录页面
**When** 用户选择"状态变更"和"进度变更"
**Then** 系统显示变更类型为"状态变更"或"进度变更"的历史记录
**And** 筛选条件显示为两个标签

#### Scenario: 按时间范围筛选
**Given** 用户在历史记录页面
**When** 用户选择日期范围:2026-01-01 至 2026-01-15
**Then** 系统只显示变更时间在指定范围内的历史记录
**And** 日期选择器显示选中的范围

#### Scenario: 组合筛选条件
**Given** 用户在历史记录页面
**When** 用户选择变更类型:"状态变更"
**And** 用户选择时间范围:2026-01-01 至 2026-01-15
**Then** 系统显示同时满足两个筛选条件的历史记录
**And** 筛选条件显示为两个标签

#### Scenario: 清除筛选条件
**Given** 用户在历史记录页面
**When** 用户已设置筛选条件
**And** 用户点击筛选条件标签的关闭按钮
**Then** 系统清除该筛选条件
**And** 历史记录列表更新
**When** 用户点击"清除所有筛选"按钮
**Then** 系统清除所有筛选条件
**And** 显示所有历史记录

### Requirement: 历史记录分页
前端 MUST 支持历史记录的分页查询,避免一次性加载大量数据。

#### Scenario: 分页浏览历史记录
**Given** 计划有 100 条历史记录
**When** 用户访问历史记录页面
**Then** 系统显示第 1 页的 20 条历史记录
**And** 页面底部显示分页组件
**And** 分页组件显示:
  - 当前页码:1
  - 总页数:5
  - 总记录数:100
  - 上一页按钮(禁用)
  - 下一页按钮(启用)
  - 页码跳转输入框
**When** 用户点击"下一页"按钮
**Then** 系统加载并显示第 2 页的历史记录
**And** 当前页码更新为 2
**And** 上一页按钮启用

#### Scenario: 跳转到指定页
**Given** 用户在历史记录页面
**When** 用户在页码跳转输入框中输入 3
**And** 用户按回车键
**Then** 系统加载并显示第 3 页的历史记录
**And** 当前页码更新为 3

#### Scenario: 跳转到无效页码
**Given** 用户在历史记录页面
**When** 用户在页码跳转输入框中输入 999
**And** 用户按回车键
**Then** 系统显示错误提示:"页码超出范围"
**And** 页码保持不变

#### Scenario: 修改每页显示数量
**Given** 用户在历史记录页面
**When** 用户点击每页显示数量下拉框,选择 50
**Then** 系统重新加载历史记录
**And** 每页显示 50 条记录
**And** 总页数更新

### Requirement: 历史记录搜索
前端 MUST 提供历史记录搜索功能,允许用户搜索特定字段或值的变更。

#### Scenario: 搜索历史记录
**Given** 用户在历史记录页面
**When** 用户在搜索框中输入"标题"
**Then** 系统实时搜索并显示变更字段包含"标题"的历史记录
**And** 搜索结果高亮显示匹配的关键词

#### Scenario: 搜索旧值或新值
**Given** 用户在历史记录页面
**When** 用户在搜索框中输入"完成项目文档"
**Then** 系统显示旧值或新值包含"完成项目文档"的历史记录
**And** 搜索结果高亮显示匹配的文本

#### Scenario: 清空搜索
**Given** 用户在历史记录页面
**When** 用户已输入搜索关键词
**And** 用户点击搜索框的清除按钮
**Then** 系统清空搜索框
**And** 显示所有历史记录

### Requirement: 历史记录详情
前端 MUST 提供历史记录详情功能,允许用户查看变更的详细信息。

#### Scenario: 查看历史记录详情
**Given** 用户在历史记录页面
**When** 用户点击某条历史记录
**Then** 系统打开详情对话框
**And** 对话框显示:
  - 变更时间(完整格式)
  - 变更类型
  - 变更字段
  - 旧值(完整显示)
  - 新值(完整显示)
  - 变更前后的对比视图(如果适用)
**And** 对话框显示"关闭"按钮

#### Scenario: 对比视图
**Given** 用户在历史记录页面
**When** 用户点击某条信息变更记录
**Then** 系统打开详情对话框
**And** 对话框显示对比视图:
  - 左侧显示旧值
  - 右侧显示新值
  - 中间显示差异高亮
  - 删除的文本显示为红色删除线
  - 新增的文本显示为绿色背景

#### Scenario: 关闭历史记录详情
**Given** 用户在历史记录详情对话框
**When** 用户点击"关闭"按钮或点击对话框外部
**Then** 系统关闭详情对话框
**And** 用户返回历史记录列表

### Requirement: 历史记录导出
前端 MUST 提供历史记录导出功能,允许用户导出历史记录为文件。

#### Scenario: 导出历史记录为 CSV
**Given** 用户在历史记录页面
**When** 用户点击"导出"按钮
**Then** 系统显示导出选项:
  - 导出为 CSV
  - 导出为 Excel
**When** 用户选择"导出为 CSV"
**Then** 系统下载 CSV 文件
**And** 文件包含所有历史记录
**And** 文件包含表头:变更时间,变更类型,变更字段,旧值,新值

#### Scenario: 导出筛选后的历史记录
**Given** 用户在历史记录页面
**When** 用户已设置筛选条件
**And** 用户点击"导出"按钮
**And** 用户选择"导出为 CSV"
**Then** 系统下载 CSV 文件
**And** 文件只包含筛选后的历史记录

#### Scenario: 导出失败
**Given** 用户在历史记录页面
**When** 用户点击"导出"按钮
**And** 导出请求失败
**Then** 系统显示错误提示:"导出失败,请稍后重试"

### Requirement: 历史记录时间线视图
前端 MUST 提供历史记录时间线视图,以时间线形式展示变更历史。

#### Scenario: 切换到时间线视图
**Given** 用户在历史记录页面
**When** 用户点击"时间线视图"按钮
**Then** 系统切换到时间线视图
**And** 历史记录以时间线形式展示
**And** 时间线从上到下按时间顺序排列
**And** 每个时间节点显示:
  - 变更时间
  - 变更类型图标
  - 变更摘要
**And** 时间线使用垂直线连接各个节点

#### Scenario: 时间线视图交互
**Given** 用户在时间线视图
**When** 用户点击某个时间节点
**Then** 系统展开该节点的详细信息
**And** 显示完整的变更记录
**And** 用户可以再次点击收起详细信息

#### Scenario: 切换回列表视图
**Given** 用户在时间线视图
**When** 用户点击"列表视图"按钮
**Then** 系统切换回列表视图
**And** 历史记录以列表形式展示

### Requirement: 历史记录加载状态
前端 MUST 在加载历史记录时显示加载状态。

#### Scenario: 加载历史记录时显示加载动画
**Given** 用户访问历史记录页面
**When** 数据正在加载
**Then** 系统显示加载动画
**And** 历史记录列表显示骨架屏
**And** 用户无法进行其他操作

#### Scenario: 加载失败时显示错误提示
**Given** 用户访问历史记录页面
**When** 数据加载失败
**Then** 系统显示错误提示:"加载失败,请稍后重试"
**And** 显示"重试"按钮
**When** 用户点击"重试"按钮
**Then** 系统重新加载历史记录

### Requirement: 空历史记录状态
前端 MUST 在没有历史记录时显示空状态提示。

#### Scenario: 显示空历史记录状态
**Given** 计划没有任何历史记录
**When** 用户访问历史记录页面
**Then** 系统显示空状态提示
**And** 提示信息:"暂无历史记录"
**And** 显示空状态图标
**And** 显示"返回计划详情"按钮

#### Scenario: 筛选后无结果
**Given** 用户在历史记录页面
**When** 用户设置筛选条件
**And** 筛选后无历史记录
**Then** 系统显示空状态提示
**And** 提示信息:"没有符合条件的历史记录"
**And** 显示"清除筛选"按钮
