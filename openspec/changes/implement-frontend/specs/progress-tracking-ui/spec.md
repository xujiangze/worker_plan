# Spec: Progress Tracking UI

## ADDED Requirements

### Requirement: 状态更新界面
前端 MUST 提供状态更新界面,允许用户更改计划状态。

#### Scenario: 在计划详情页面更新状态
**Given** 用户在计划详情页面
**When** 用户点击状态标签
**Then** 系统显示状态下拉菜单
**And** 菜单显示所有可选状态:
  - 待开始
  - 进行中
  - 已完成
  - 已取消
**When** 用户选择"进行中"
**Then** 系统发送 PATCH 请求到 `/api/plans/:id/status`
**And** 系统显示成功提示:"状态更新成功"
**And** 状态标签更新为"进行中"
**And** 更新时间刷新

#### Scenario: 状态更新成功后自动跳转
**Given** 用户在计划详情页面
**When** 用户将状态从"进行中"更新为"已完成"
**Then** 系统发送 PATCH 请求到 `/api/plans/:id/status`
**And** 系统显示成功提示:"恭喜!计划已完成"
**And** 系统显示庆祝动画或图标

#### Scenario: 状态更新失败
**Given** 用户在计划详情页面
**When** 用户更新状态
**And** 请求失败(网络错误或服务器错误)
**Then** 系统显示错误提示:"状态更新失败,请稍后重试"
**And** 状态保持不变

#### Scenario: 状态更新时显示加载状态
**Given** 用户在计划详情页面
**When** 用户更新状态
**And** 请求正在处理
**Then** 系统显示加载动画
**And** 状态标签显示加载状态
**And** 用户无法再次更新状态

### Requirement: 进度条组件
前端 MUST 提供进度条组件,显示计划的完成百分比,并允许用户更新进度。

#### Scenario: 显示进度条
**Given** 用户在计划详情页面
**When** 页面加载完成
**Then** 系统显示进度条
**And** 进度条显示当前进度百分比(如 50%)
**And** 进度条颜色根据进度变化:
  - 0-30%: 红色
  - 31-70%: 橙色
  - 71-100%: 绿色

#### Scenario: 拖动进度条更新进度
**Given** 用户在计划详情页面
**When** 用户拖动进度条滑块到 75%
**Then** 系统实时显示进度百分比
**And** 进度条颜色更新为绿色
**When** 用户释放滑块
**Then** 系统发送 PATCH 请求到 `/api/plans/:id/progress`
**And** 系统显示成功提示:"进度更新成功"
**And** 进度条更新为 75%

#### Scenario: 直接输入进度百分比
**Given** 用户在计划详情页面
**When** 用户点击进度百分比数字
**Then** 系统显示输入框
**When** 用户输入 80 并按回车键
**Then** 系统验证输入值(0-100)
**And** 系统发送 PATCH 请求到 `/api/plans/:id/progress`
**And** 进度条更新为 80%

#### Scenario: 输入无效的进度值
**Given** 用户在计划详情页面
**When** 用户点击进度百分比数字
**And** 用户输入 150
**And** 用户按回车键
**Then** 系统显示错误提示:"进度必须在 0-100 之间"
**And** 进度保持不变

#### Scenario: 进度达到 100% 时自动更新状态
**Given** 用户在计划详情页面
**When** 用户将进度更新为 100%
**Then** 系统发送 PATCH 请求到 `/api/plans/:id/progress`
**And** 系统自动将状态更新为"已完成"
**And** 系统显示成功提示:"恭喜!计划已完成"
**And** 状态标签更新为"已完成"

#### Scenario: 进度小于 100% 时状态保持为进行中
**Given** 用户在计划详情页面
**When** 计划状态为"已完成",进度为 100%
**And** 用户将进度更新为 80%
**Then** 系统发送 PATCH 请求到 `/api/plans/:id/progress`
**And** 系统自动将状态更新为"进行中"
**And** 状态标签更新为"进行中"

### Requirement: 历史记录页面
前端 MUST 提供历史记录页面,显示计划的所有变更历史。

#### Scenario: 查看计划历史记录
**Given** 用户在计划详情页面
**When** 用户点击"历史记录"标签或按钮
**Then** 系统跳转到历史记录页面 `/plans/:id/history`
**And** 系统显示该计划的所有历史记录
**And** 历史记录按时间降序排列(最新的在前)
**And** 每条历史记录显示:
  - 变更时间
  - 变更类型(状态/进度/信息)
  - 变更字段
  - 旧值
  - 新值

#### Scenario: 显示状态变更历史
**Given** 用户在历史记录页面
**When** 系统显示状态变更记录
**Then** 记录显示:
  - 变更类型:"状态变更"
  - 变更字段:"状态"
  - 旧值:"待开始"
  - 新值:"进行中"
  - 变更时间:"2026-01-05 15:00:00"
**And** 记录使用蓝色标签标识

#### Scenario: 显示进度变更历史
**Given** 用户在历史记录页面
**When** 系统显示进度变更记录
**Then** 记录显示:
  - 变更类型:"进度变更"
  - 变更字段:"进度"
  - 旧值:"0%"
  - 新值:"50%"
  - 变更时间:"2026-01-05 14:00:00"
**And** 记录使用绿色标签标识

#### Scenario: 显示信息变更历史
**Given** 用户在历史记录页面
**When** 系统显示信息变更记录
**Then** 记录显示:
  - 变更类型:"信息变更"
  - 变更字段:"标题"
  - 旧值:"完成项目文档"
  - 新值:"完成项目文档(更新)"
  - 变更时间:"2026-01-05 15:00:00"
**And** 记录使用灰色标签标识

#### Scenario: 按变更类型筛选历史记录
**Given** 用户在历史记录页面
**When** 用户点击筛选下拉框,选择"状态变更"
**Then** 系统只显示变更类型为"状态变更"的历史记录
**And** 筛选条件显示在页面上

#### Scenario: 按时间范围筛选历史记录
**Given** 用户在历史记录页面
**When** 用户选择日期范围:2026-01-01 至 2026-01-15
**Then** 系统只显示变更时间在指定范围内的历史记录

#### Scenario: 分页浏览历史记录
**Given** 计划有 100 条历史记录
**When** 用户访问历史记录页面
**Then** 系统显示第 1 页的 20 条历史记录
**And** 页面底部显示分页组件
**When** 用户点击"下一页"按钮
**Then** 系统加载并显示第 2 页的历史记录

#### Scenario: 空历史记录显示
**Given** 计划没有任何历史记录
**When** 用户访问历史记录页面
**Then** 系统显示空状态提示
**And** 提示信息:"暂无历史记录"

#### Scenario: 加载历史记录时显示加载状态
**Given** 用户访问历史记录页面
**When** 数据正在加载
**Then** 系统显示加载动画
**And** 用户无法进行其他操作

### Requirement: 快捷操作按钮
前端 MUST 在计划列表页面提供快捷操作按钮,方便用户快速更新状态和进度。

#### Scenario: 快速开始计划
**Given** 用户在计划列表页面
**When** 用户看到状态为"待开始"的计划
**Then** 计划卡片显示"开始"按钮
**When** 用户点击"开始"按钮
**Then** 系统将状态更新为"进行中"
**And** 系统显示成功提示:"计划已开始"
**And** 按钮变为"暂停"按钮

#### Scenario: 快速完成计划
**Given** 用户在计划列表页面
**When** 用户看到状态为"进行中"的计划
**Then** 计划卡片显示"完成"按钮
**When** 用户点击"完成"按钮
**Then** 系统将状态更新为"已完成"
**And** 系统显示成功提示:"恭喜!计划已完成"
**And** 按钮变为"重新开始"按钮

#### Scenario: 快速取消计划
**Given** 用户在计划列表页面
**When** 用户看到计划卡片
**Then** 计划卡片显示"取消"按钮
**When** 用户点击"取消"按钮
**Then** 系统显示确认对话框
**And** 对话框显示提示信息:"确定要取消此计划吗?"
**When** 用户点击"确定"按钮
**Then** 系统将状态更新为"已取消"
**And** 系统显示成功提示:"计划已取消"

#### Scenario: 快速更新进度
**Given** 用户在计划列表页面
**When** 用户看到计划卡片
**Then** 计划卡片显示进度条
**When** 用户拖动进度条滑块
**Then** 系统实时显示进度百分比
**When** 用户释放滑块
**Then** 系统更新进度
**And** 系统显示成功提示:"进度更新成功"

### Requirement: 进度提醒
前端 MUST 提供进度提醒功能,提醒用户即将到期的计划。

#### Scenario: 显示即将到期的计划
**Given** 用户在计划列表页面
**When** 存在截止日期在 3 天内的计划
**Then** 计划卡片显示警告图标
**And** 卡片边框显示为橙色
**And** 提示信息:"即将到期"

#### Scenario: 显示已过期的计划
**Given** 用户在计划列表页面
**When** 存在截止日期已过且状态不为"已完成"的计划
**Then** 计划卡片显示错误图标
**And** 卡片边框显示为红色
**And** 提示信息:"已过期"

#### Scenario: 显示即将到期的计划数量
**Given** 用户在计划列表页面
**When** 存在 3 个即将到期的计划
**Then** 页面顶部显示通知
**And** 通知显示:"您有 3 个计划即将到期"
**And** 通知显示"查看"按钮
**When** 用户点击"查看"按钮
**Then** 系统筛选并显示即将到期的计划
