# 实施任务清单

## 1. 后端实现

### 1.1 数据模型验证
- [x] 1.1.1 验证 Plans 表包含所有必需字段(id, title, description, priority, status, due_date, progress, created_at, updated_at, deleted_at)
- [x] 1.1.2 验证 PlanHistory 表包含所有必需字段(id, plan_id, field_name, old_value, new_value, change_type, changed_at)
- [x] 1.1.3 确保数据库索引正确(为 plan_id 创建索引)

### 1.2 API 路由实现
- [x] 1.2.1 实现 PATCH /api/plans/:id/status 路由
- [x] 1.2.2 实现 PATCH /api/plans/:id/progress 路由
- [x] 1.2.3 添加路由参数验证(plan_id 必须为正整数)

### 1.3 服务层实现
- [x] 1.3.1 实现更新计划状态服务方法
  - [x] 验证状态值的有效性(Todo, InProgress, Done, Cancelled)
  - [x] 记录状态变更历史到 PlanHistory 表
  - [x] 返回更新后的计划信息
- [x] 1.3.2 实现更新计划进度服务方法
  - [x] 验证进度值的有效性(0-100)
  - [x] 实现进度与状态联动逻辑
    - [x] 进度 > 0 且状态为 Todo → 自动更新为 InProgress
    - [x] 进度 = 100 → 自动更新为 Done
    - [x] 进度 < 100 且状态为 Done → 自动更新为 InProgress
  - [x] 记录进度变更历史到 PlanHistory 表
  - [x] 返回更新后的计划信息
- [x] 1.3.3 实现状态转换验证逻辑
  - [x] 允许所有合法的状态转换
  - [x] 记录所有状态变更历史

### 1.4 错误处理
- [x] 1.4.1 处理计划不存在的情况(返回 404)
- [x] 1.4.2 处理无效状态值的情况(返回 400)
- [x] 1.4.3 处理进度值超出范围的情况(返回 400)
- [x] 1.4.4 处理数据库错误(返回 500)

### 1.5 测试
- [ ] 1.5.1 编写更新计划状态的单元测试
- [ ] 1.5.2 编写更新计划进度的单元测试
- [ ] 1.5.3 编写状态转换验证的单元测试
- [ ] 1.5.4 编写进度与状态联动的单元测试
- [ ] 1.5.5 编写错误处理的单元测试

## 2. 前端实现

### 2.1 API 客户端
- [x] 2.1.1 添加更新计划状态的 API 方法(patchPlanStatus)
- [x] 2.1.2 添加更新计划进度的 API 方法(patchPlanProgress)
- [x] 2.1.3 添加错误处理和重试逻辑

### 2.2 状态更新界面
- [x] 2.2.1 创建状态下拉菜单组件
  - [x] 显示所有可选状态(待开始、进行中、已完成、已取消)
  - [x] 支持点击选择状态
  - [x] 显示当前状态
- [x] 2.2.2 集成到计划列表页面
  - [x] 在计划卡片中显示状态标签
  - [x] 点击状态标签显示下拉菜单
  - [x] 选择状态后调用 API 更新
- [x] 2.2.3 添加加载状态显示
  - [x] 请求处理时显示加载动画
  - [x] 禁用状态更新按钮
- [x] 2.2.4 添加错误处理
  - [x] 显示成功提示("状态更新成功")
  - [x] 显示错误提示("状态更新失败,请稍后重试")

### 2.3 进度百分比输入
- [x] 2.3.1 创建进度输入组件
  - [x] 显示当前进度百分比
  - [x] 点击数字显示输入框
  - [x] 支持输入 0-100 的数字
  - [x] 按回车键或失去焦点时提交
- [x] 2.3.2 集成到计划列表页面
  - [x] 在计划卡片中显示进度输入
  - [x] 输入后调用 API 更新
- [x] 2.3.3 添加输入验证
  - [x] 验证输入值在 0-100 之间
  - [x] 显示错误提示("进度必须在 0-100 之间")
- [x] 2.3.4 添加加载状态显示
  - [x] 请求处理时显示加载动画
  - [x] 禁用进度输入
- [x] 2.3.5 添加错误处理
  - [x] 显示成功提示("进度更新成功")
  - [x] 显示错误提示("进度更新失败,请稍后重试")

### 2.4 进度条组件
- [x] 2.4.1 创建 ProgressBar 组件
  - [x] 接收 progress 属性(0-100)
  - [x] 接收 color 属性(可选: success, warning, danger)
  - [x] 接收 animated 属性(可选: true/false)
  - [x] 显示进度条填充
  - [x] 显示进度百分比文字
- [x] 2.4.2 实现进度条动画
  - [x] 使用 CSS transition 实现平滑过渡
  - [x] 动画时长为 0.5 秒
- [x] 2.4.3 实现不同颜色的进度条
  - [x] success: 绿色
  - [x] warning: 橙色
  - [x] danger: 红色
  - [x] 默认: 蓝色
- [x] 2.4.4 集成到计划列表页面
  - [x] 在计划卡片中显示进度条
  - [x] 根据进度值设置颜色

### 2.5 到期提醒功能
- [x] 2.5.1 创建到期提醒标签组件
  - [x] 接收 dueDate 属性
  - [x] 计算到期状态(已过期、即将到期、正常)
  - [x] 显示对应的标签和颜色
- [x] 2.5.2 实现到期状态判断逻辑
  - [x] 已过期: 截止日期 < 当前日期
  - [x] 即将到期: 截止日期 - 当前日期 <= 7 天
  - [x] 正常: 截止日期 - 当前日期 > 7 天
- [x] 2.5.3 集成到计划列表页面
  - [x] 在计划卡片中显示到期提醒标签
  - [x] 已过期: 红色标签"已过期"
  - [x] 即将到期: 橙色标签"即将到期"
  - [x] 正常: 不显示标签
  - [x] 无截止日期: 不显示标签

### 2.6 进度追踪页面
- [x] 2.6.1 创建进度追踪页面组件
  - [x] 显示所有计划的进度概览
  - [x] 显示进度统计信息
  - [x] 提供筛选和排序功能
- [x] 2.6.2 添加路由配置
  - [x] 配置 /progress 路由
  - [x] 在导航菜单中添加"进度跟踪"链接

### 2.7 测试
- [ ] 2.7.1 编写状态更新组件的单元测试
- [ ] 2.7.2 编写进度输入组件的单元测试
- [ ] 2.7.3 编写进度条组件的单元测试
- [ ] 2.7.4 编写到期提醒组件的单元测试
- [ ] 2.7.5 编写进度追踪页面的集成测试

## 3. 集成和验证

### 3.1 后端集成测试
- [ ] 3.1.1 测试完整的进度更新流程
- [ ] 3.1.2 测试状态转换的所有场景
- [ ] 3.1.3 测试进度与状态联动逻辑
- [ ] 3.1.4 测试历史记录的保存

### 3.2 前端集成测试
- [ ] 3.2.1 测试状态更新流程
- [ ] 3.2.2 测试进度更新流程
- [ ] 3.2.3 测试进度条显示和动画
- [ ] 3.2.4 测试到期提醒显示

### 3.3 端到端测试
- [ ] 3.3.1 测试用户创建计划并更新进度的完整流程
- [ ] 3.3.2 测试用户查看进度历史记录的流程
- [ ] 3.3.3 测试到期提醒的准确性

### 3.4 性能测试
- [ ] 3.4.1 测试 API 响应时间(P95 < 200ms)
- [ ] 3.4.2 测试并发更新进度的性能
- [ ] 3.4.3 测试前端页面加载时间(< 2s)

## 4. 文档和部署

### 4.1 文档更新
- [ ] 4.1.1 更新 API 文档,添加进度追踪相关接口
- [ ] 4.1.2 更新用户手册,说明进度追踪功能的使用方法
- [ ] 4.1.3 更新开发文档,说明进度追踪的实现细节

### 4.2 部署准备
- [ ] 4.2.1 准备数据库迁移脚本(如果需要)
- [ ] 4.2.2 准备部署清单
- [ ] 4.2.3 准备回滚计划

### 4.3 验收测试
- [ ] 4.3.1 验证所有功能需求已实现
- [ ] 4.3.2 验证所有用户场景可正常使用
- [ ] 4.3.3 验证 API 接口符合设计规范
- [ ] 4.3.4 验证性能指标达标
- [ ] 4.3.5 验证代码符合规范
