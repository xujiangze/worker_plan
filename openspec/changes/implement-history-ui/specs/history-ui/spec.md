# history-ui Specification

## Purpose
定义历史记录功能的前端界面规范,包括历史记录列表展示、筛选、分页等功能。

## ADDED Requirements

### Requirement: 显示计划基本信息
历史记录页面 MUST 在页面顶部显示计划的基本信息,包括标题、状态、优先级、进度等。

#### Scenario: 显示计划基本信息
**Given** 用户访问计划 ID 为 1 的历史记录页面
**When** 页面加载完成
**Then** 页面顶部显示计划的基本信息卡片:
- 计划标题
- 当前状态 (Todo/InProgress/Done/Cancelled)
- 优先级 (High/Medium/Low)
- 进度百分比
- 截止日期(如果有)

### Requirement: 显示历史记录列表
历史记录页面 MUST 以列表形式展示计划的所有历史变更记录。

#### Scenario: 显示历史记录列表
**Given** 计划 ID 为 1 的计划有 5 条历史记录
**When** 用户访问历史记录页面
**Then** 页面显示 5 条历史记录
**And** 每条记录包含:
- 变更类型标签 (Status/Progress/Info)
- 变更时间
- 字段名称
- 旧值
- 新值
**And** 历史记录按时间倒序排列(最新的在前)

#### Scenario: 显示空历史记录
**Given** 计划 ID 为 1 的计划没有任何历史记录
**When** 用户访问历史记录页面
**Then** 页面显示"暂无历史记录"的提示信息

### Requirement: 按变更类型筛选
历史记录页面 MUST 允许用户按变更类型筛选历史记录。

#### Scenario: 筛选状态变更记录
**Given** 历史记录页面显示多种类型的变更记录
**When** 用户选择变更类型为 "Status"
**Then** 页面只显示变更类型为 "Status" 的历史记录
**And** 其他类型的记录被隐藏

#### Scenario: 筛选进度变更记录
**Given** 历史记录页面显示多种类型的变更记录
**When** 用户选择变更类型为 "Progress"
**Then** 页面只显示变更类型为 "Progress" 的历史记录

#### Scenario: 筛选信息变更记录
**Given** 历史记录页面显示多种类型的变更记录
**When** 用户选择变更类型为 "Info"
**Then** 页面只显示变更类型为 "Info" 的历史记录

#### Scenario: 清除筛选条件
**Given** 用户已选择变更类型为 "Status"
**When** 用户选择变更类型为 "全部"
**Then** 页面显示所有类型的历史记录

### Requirement: 按时间范围筛选
历史记录页面 MUST 允许用户按时间范围筛选历史记录。

#### Scenario: 筛选指定时间范围内的记录
**Given** 历史记录页面显示 2024-01-01 至 2024-01-31 的历史记录
**When** 用户选择时间范围为 2024-01-01 至 2024-01-15
**Then** 页面只显示变更时间在 2024-01-01 至 2024-01-15 范围内的历史记录

#### Scenario: 清除时间范围筛选
**Given** 用户已选择时间范围
**When** 用户清除时间范围选择
**Then** 页面显示所有时间的历史记录

### Requirement: 历史记录分页
历史记录页面 MUST 支持分页功能,避免一次性加载过多数据。

#### Scenario: 分页显示历史记录
**Given** 计划有 100 条历史记录
**When** 用户访问历史记录页面
**Then** 页面默认显示第 1 页的 20 条记录
**And** 页面底部显示分页控件
**And** 分页控件显示总页数和当前页码

#### Scenario: 切换到下一页
**Given** 用户在第 1 页
**When** 用户点击"下一页"按钮
**Then** 页面加载并显示第 2 页的记录
**And** URL 更新为包含 page=2 参数

#### Scenario: 跳转到指定页
**Given** 用户在第 1 页
**When** 用户点击页码 "5"
**Then** 页面加载并显示第 5 页的记录

### Requirement: 变更类型视觉区分
历史记录页面 MUST 使用不同的颜色和标签区分不同类型的变更。

#### Scenario: 状态变更的视觉样式
**Given** 历史记录列表中有一条状态变更记录
**When** 页面渲染该记录
**Then** 变更类型标签显示为蓝色
**And** 标签文本为 "状态"

#### Scenario: 进度变更的视觉样式
**Given** 历史记录列表中有一条进度变更记录
**When** 页面渲染该记录
**Then** 变更类型标签显示为绿色
**And** 标签文本为 "进度"

#### Scenario: 信息变更的视觉样式
**Given** 历史记录列表中有一条信息变更记录
**When** 页面渲染该记录
**Then** 变更类型标签显示为灰色
**And** 标签文本为 "信息"

### Requirement: 返回计划列表
历史记录页面 MUST 提供返回计划列表的功能。

#### Scenario: 点击返回按钮
**Given** 用户在历史记录页面
**When** 用户点击页面左上角的"返回"按钮
**Then** 页面跳转到计划列表页面

#### Scenario: 使用浏览器返回
**Given** 用户在历史记录页面
**When** 用户点击浏览器的"返回"按钮
**Then** 页面跳转到上一个页面

### Requirement: 从计划列表跳转到历史记录
计划列表页面 MUST 提供跳转到历史记录页面的入口。

#### Scenario: 点击查看历史按钮
**Given** 用户在计划列表页面
**When** 用户点击某个计划的"查看历史"按钮
**Then** 页面跳转到该计划的历史记录页面
**And** URL 格式为 `/history/:planId`

### Requirement: 加载状态显示
历史记录页面 MUST 在数据加载时显示加载状态。

#### Scenario: 显示加载状态
**Given** 用户访问历史记录页面
**When** 数据正在加载中
**Then** 页面显示加载动画或加载提示
**And** 历史记录列表区域显示为空

#### Scenario: 加载完成
**Given** 数据正在加载中
**When** 数据加载完成
**Then** 加载动画消失
**And** 历史记录列表显示数据

### Requirement: 错误处理
历史记录页面 MUST 在 API 请求失败时显示错误信息。

#### Scenario: 显示错误信息
**Given** 用户访问历史记录页面
**When** API 请求失败
**Then** 页面显示错误提示信息
**And** 错误信息说明失败原因
**And** 提供"重试"按钮

#### Scenario: 重试加载
**Given** 页面显示错误信息
**When** 用户点击"重试"按钮
**Then** 页面重新发起 API 请求
**And** 如果成功,显示历史记录列表
**And** 如果失败,继续显示错误信息

### Requirement: 响应式设计
历史记录页面 MUST 支持不同屏幕尺寸的响应式布局。

#### Scenario: 桌面端显示
**Given** 用户使用桌面端浏览器(宽度 >= 1200px)
**When** 用户访问历史记录页面
**Then** 页面使用宽屏布局
**And** 历史记录列表显示为多列或宽卡片

#### Scenario: 平板端显示
**Given** 用户使用平板端浏览器(768px <= 宽度 < 1200px)
**When** 用户访问历史记录页面
**Then** 页面使用中等布局
**And** 历史记录列表适当调整间距

#### Scenario: 移动端显示
**Given** 用户使用移动端浏览器(宽度 < 768px)
**When** 用户访问历史记录页面
**Then** 页面使用单列布局
**And** 历史记录列表显示为单列卡片
**And** 筛选栏和分页控件适配移动端

### Requirement: 日期格式化
历史记录页面 MUST 以用户友好的格式显示日期和时间。

#### Scenario: 格式化变更时间
**Given** 历史记录的变更时间为 "2024-01-01T12:30:45Z"
**When** 页面渲染该记录
**Then** 变更时间显示为 "2024-01-01 12:30"
**And** 使用本地时区

#### Scenario: 格式化截止日期
**Given** 计划的截止日期为 "2024-12-31T23:59:59Z"
**When** 页面渲染计划信息卡片
**Then** 截止日期显示为 "2024-12-31"
